<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JackpotVault — Case Opener</title>
  <style>
    *{box-sizing:border-box;font-family:Inter,system-ui,Arial,Helvetica,sans-serif}
    :root{--bg:#071226;--card:#0b1730;--muted:rgba(230,238,248,.85)}
    body{background:linear-gradient(180deg,#031026 0%,#071226 60%);color:var(--muted);display:flex;align-items:center;justify-content:center;height:100vh;margin:0;overflow:hidden;}
    .stage{width:1100px;max-width:96%;display:grid;grid-template-columns:1fr 300px;gap:18px;position:relative;}

    header{grid-column:1/3;display:flex;align-items:center;gap:16px}
    h1{font-size:20px;margin:0;color: #f5e9c8;letter-spacing:0.6px}

    /* JackpotVault logo */
    .logo{font-weight:900;font-size:22px;padding:8px 14px;border-radius:10px;background:linear-gradient(90deg,#1a1208,#3a2a11);box-shadow:0 8px 30px rgba(0,0,0,.6);display:inline-block;position:relative; user-select:none;}
    .logo .gold{background:linear-gradient(90deg,#ffd86b,#fff0c8,#ffd86b);-webkit-background-clip:text;background-clip:text;color:transparent;animation:shine 2.6s linear infinite}
    @keyframes shine{0%{background-position:-200%}50%{background-position:200%}100%{background-position:-200%}}
    .logo:after{content:'';position:absolute;inset:0;border-radius:10px;box-shadow:0 2px 30px rgba(255,215,0,.08) inset}

    .viewport{grid-column:1/1;position:relative;height:160px;overflow:hidden;border-radius:14px;background:linear-gradient(180deg,#071730,#071026);box-shadow:0 10px 40px rgba(0,0,0,.6);border:1px solid rgba(255,255,255,.03)}
    .strip{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);display:flex;will-change:transform; user-select:none;}
    .item{width:160px;height:130px;margin:0 10px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;letter-spacing:.6px;flex-shrink:0;position:relative;transition:transform .15s linear,opacity .15s linear; cursor:default;}
    .rarity-common{background:linear-gradient(180deg,#dff3ff,#bfe8ff);color:#0a3a54}
    .rarity-rare{background:linear-gradient(180deg,#efe7ff,#d2c1ff);color:#240a4a}
    .rarity-epic{background:linear-gradient(180deg,#fff1dc,#ffd2a8);color:#4b2b00}
    .rarity-legendary{background:linear-gradient(180deg,#fff0f0,#ffe0ff);color:#40002a;box-shadow:0 8px 40px rgba(255,180,220,.10)}

    .center-marker{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      width:190px;
      height:150px;
      border-radius:12px;
      pointer-events:none;
      border:2px solid rgba(255,255,255,.06);
      box-shadow:0 30px 80px rgba(2,6,12,.6) inset;
      user-select:none;
      z-index:5;
    }
    /* Arrow marker on top */
    .arrow-marker {
      position: absolute;
      top: calc(50% - 90px);
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 18px solid transparent;
      border-right: 18px solid transparent;
      border-bottom: 30px solid #ffd86b;
      filter: drop-shadow(0 0 5px #ffdc70);
      user-select:none;
      z-index: 10;
    }

    .controls{display:flex;gap:12px;align-items:center;margin-top:14px;flex-wrap:wrap;}
    .controls button{
      background:linear-gradient(180deg,#1b6ed6,#0f4aa0);
      border:0;
      padding:12px 16px;
      border-radius:10px;
      color:white;
      font-weight:900;
      cursor:pointer;
      box-shadow:0 8px 30px rgba(15,74,160,.18);
      flex:1 1 200px;
      min-width:120px;
      user-select:none;
      transition:background-color .25s ease;
    }
    .controls button:hover:not(:disabled){background:linear-gradient(180deg,#256fd8,#1761be);}
    .controls button[disabled]{opacity:.45;cursor:default}

    .meta{display:flex;justify-content:space-between;align-items:center;margin-top:12px;flex-wrap:wrap;}
    .info{font-size:13px;opacity:.9;flex:1 1 100%;}

    /* sidebar */
    .sidebar{
      background:linear-gradient(180deg,#071226,#05111d);
      border-radius:12px;
      padding:12px;
      border:1px solid rgba(255,255,255,.03);
      height:100%;
      display:flex;
      flex-direction:column;
      user-select:none;
    }
    .sidebar h3{margin:0 0 8px 0;font-size:15px;color:#f8efda}
    .balance{
      font-weight:900;
      font-size:18px;
      margin-bottom:10px;
      display:flex;
      align-items:center;
      gap:6px;
      user-select:none;
      position:relative;
      padding-left: 30px;
    }
    /* subtle dollar icons in bg */
    .balance::before {
      content: "$$$";
      font-weight: 900;
      font-size: 24px;
      position: absolute;
      left: 6px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255, 215, 0, 0.2);
      letter-spacing: 5px;
      user-select:none;
      pointer-events:none;
      font-family: monospace;
    }
    .history-list{overflow:auto;max-height:62vh;padding-right:6px}
    .history-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,.02);font-size:13px}
    .history-item .name{font-weight:700}
    .history-item .rar{opacity:.85;font-size:12px}

    .prob{font-size:12px;opacity:.85;margin-top:8px}

    /* result toast */
    .result-toast{
      position:fixed;
      left:50%;
      top:18%;
      transform:translateX(-50%);
      background:linear-gradient(180deg,#071024,#0b1a33);
      padding:14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.04);
      display:none;
      min-width:360px;
      user-select:none;
      z-index:1000;
    }
    .result-toast.show{display:block}

    /* pack selector screen */
    #packSelector {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg,#031026 0%,#071226 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 25px;
      z-index: 2000;
      border-radius: 14px;
      box-shadow: 0 0 30px rgba(255,215,0,.15);
      user-select:none;
    }
    #packSelector h2 {
      color: #ffd86b;
      font-size: 28px;
      text-shadow: 0 0 6px #ffd86b;
      margin: 0;
    }
    .pack-choice {
      background: linear-gradient(180deg,#1b6ed6,#0f4aa0);
      padding: 16px 36px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 20px;
      color: white;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(15,74,160,.25);
      user-select:none;
      transition: background-color 0.3s ease;
      width: 280px;
      text-align:center;
    }
    .pack-choice:hover {
      background: linear-gradient(180deg,#256fd8,#1761be);
    }

    #backBtn {
      margin-top: 20px;
      background: linear-gradient(180deg,#444444,#222222);
      padding: 10px 24px;
      border-radius: 10px;
      font-weight: 700;
      color: #ffd86b;
      border: 1px solid #ffd86b;
      cursor: pointer;
      user-select:none;
      transition: background-color 0.3s ease;
      width: 140px;
      text-align:center;
      box-shadow: 0 0 14px rgba(255,215,0,0.6);
    }
    #backBtn:hover {
      background: linear-gradient(180deg,#666666,#444444);
    }
  </style>
</head>
<body>
  <div class="stage" id="mainStage" style="display:none;">
    <header>
      <div class="logo"><span class="gold">JackpotVault</span></div>
      <h1 id="packTitle">Case Opener</h1>
    </header>

    <div>
      <div class="viewport" id="viewport">
        <div class="strip" id="strip"></div>
        <div class="center-marker"></div>
        <div class="arrow-marker"></div>
      </div>

      <div class="controls" id="controls">
        <button id="openBtn">Open Pack</button>
        <button id="backBtn" style="display:none;">Back to Cases</button>
        <div class="info" id="costInfo" style="flex: 1 1 100%; margin-top: 6px;">Cost: <strong>$0</strong></div>
        <div style="margin-left:auto;font-size:13px;opacity:.95" id="probInfo"></div>
      </div>

      <div class="meta">
        <div class="info">The item under the golden arrow when it stops is awarded and automatically added to your balance.</div>
        <div class="info">You will see many items pass quickly — like CS:GO pack openings.</div>
      </div>
    </div>

    <aside class="sidebar">
      <div class="balance">Balance: <span id="balance">$1,000</span></div>
      <h3>Packed Items</h3>
      <div class="history-list" id="historyList"></div>
      <div class="prob">Legendary lights up confetti and a special sound.</div>
    </aside>
  </div>

  <div id="packSelector">
    <h2>Select a Pack to Open</h2>
    <div class="pack-choice" data-pack="gershon">Houses Pack — Houses — $30,000</div>
    <div class="pack-choice" data-pack="clothing">Clothing Case — Fashion Items — $20</div>
  </div>

  <!-- Audio -->
  <audio id="rollSound" src="https://cdn.pixabay.com/download/audio/2022/03/19/audio_688ff7c65b.mp3?filename=slot-machine-roll-26179.mp3" preload="auto"></audio>

  <script>
    // Packs definition
    const packs = {
      gershon: {
        name: "Houses Pack",
        cost: 30000,
        rarityWeight: {common:65, rare:22, epic:10, legendary:3},
        items: [
          {id:1, name:'One-Room Studio', rarity:'common', valueUSD:25000},
          {id:2, name:'Suburban Bungalow', rarity:'common', valueUSD:42000},
          {id:3, name:'Modern Apartment', rarity:'rare', valueUSD:85000},
          {id:4, name:'Townhouse', rarity:'rare', valueUSD:120000},
          {id:5, name:'Seaside Villa', rarity:'epic', valueUSD:320000},
          {id:6, name:'Mountain Chalet', rarity:'epic', valueUSD:410000},
          {id:7, name:'Skyline Penthouse', rarity:'legendary', valueUSD:2200000},
          {id:8, name:'Historic Manor', rarity:'legendary', valueUSD:1850000}
        ],
        probabilitiesText: 'Common 65% · Rare 22% · Epic 10% · Legendary 3%'
      },
      clothing: {
        name: "Clothing Case",
        cost: 20,
        rarityWeight: {common:65, rare:22, epic:10, legendary:3},
        items: [
          {id:101, name:'Nike Socks', rarity:'common', valueUSD:5},
          {id:102, name:'Zara T-Shirt', rarity:'common', valueUSD:12},
          {id:103, name:'Adidas Cap', rarity:'common', valueUSD:15},
          {id:104, name:'Levis Jeans', rarity:'rare', valueUSD:28},
          {id:105, name:'Nike Sneakers', rarity:'rare', valueUSD:35},
          {id:106, name:'H&M Jacket', rarity:'epic', valueUSD:65},
          {id:107, name:'Gucci Belt', rarity:'epic', valueUSD:180},
          {id:108, name:'Prada Handbag', rarity:'legendary', valueUSD:1200},
          {id:109, name:'Louis Vuitton Jacket', rarity:'legendary', valueUSD:2200}
        ],
        probabilitiesText: 'Common 65% · Rare 22% · Epic 10% · Legendary 3%'
      }
    };

    // DOM elements
    const packSelector = document.getElementById('packSelector');
    const mainStage = document.getElementById('mainStage');
    const packTitle = document.getElementById('packTitle');
    const strip = document.getElementById('strip');
    const viewport = document.getElementById('viewport');
    const openBtn = document.getElementById('openBtn');
    const backBtn = document.getElementById('backBtn');
    const costInfo = document.getElementById('costInfo');
    const probInfo = document.getElementById('probInfo');
    const balanceEl = document.getElementById('balance');
    const resultBox = document.getElementById('resultBox');
    const resultTitle = document.getElementById('resultTitle');
    const resultDetails = document.getElementById('resultDetails');
    const historyList = document.getElementById('historyList');
    const rollSound = document.getElementById('rollSound');

    let balance = 1000;
    let rolling = false;
    let history = [];
    let currentPack = null;

    balanceEl.textContent = '$' + balance.toLocaleString();

    // Helper: create weighted pool
    function createWeightedPool(items, weights){
      const weighted = [];
      for(const i of items){
        const w = weights[i.rarity] || 1;
        for(let j=0; j<w; j++) weighted.push(i);
      }
      return weighted;
    }

    // Create random strip with guaranteed winner at center under arrow
    function createRandomStrip(pack, count=140){
      const weighted = createWeightedPool(pack.items, pack.rarityWeight);
      const seq = [];
      for(let i=0; i<count; i++){
        const pick = weighted[Math.floor(Math.random()*weighted.length)];
        seq.push(Object.assign({},pick));
      }
      return seq;
    }

    // Render strip items
    function renderStrip(seq){
      strip.innerHTML = '';
      for(const it of seq){
        const div = document.createElement('div');
        div.className = 'item rarity-' + it.rarity;
        div.dataset.id = it.id;
        div.innerHTML = `<div style="text-align:center; user-select:none;">
          <div style="font-size:12px;opacity:.85">${it.rarity.toUpperCase()}</div>
          <div style="font-size:15px;margin-top:6px">${it.name}</div>
          <div style="font-size:12px;margin-top:6px;opacity:.85">$${it.valueUSD.toLocaleString()}</div>
          </div>`;
        strip.appendChild(div);
      }
    }

    // Get center X of viewport for centering animation
    function getCenterX(){
      const rect = viewport.getBoundingClientRect();
      return rect.width/2;
    }

    // Pick winner based on rarity weights
    function weightedPickByRarity(pack){
      const total = Object.values(pack.rarityWeight).reduce((a,b)=>a+b,0);
      let r = Math.random()*total;
      let chosenRarity = 'common';
      for(const k of Object.keys(pack.rarityWeight)){
        if(r < pack.rarityWeight[k]){ chosenRarity = k; break; }
        r -= pack.rarityWeight[k];
      }
      const pool = pack.items.filter(i=>i.rarity === chosenRarity);
      if(pool.length === 0) return pack.items[0];
      return pool[Math.floor(Math.random()*pool.length)];
    }

    // Award user with item
    function award(item){
      history.unshift({
        ...item,
        ts: Date.now(),
        value: item.valueUSD
      });
      updateBalance(item.valueUSD);
      renderHistoryUI();
      // Show a toast or something if wanted
      alert(`You got: ${item.name} (${item.rarity.toUpperCase()}) worth $${item.valueUSD.toLocaleString()}`);
    }

    // Update balance with new value
    function updateBalance(inc){
      balance += inc;
      balanceEl.textContent = '$' + balance.toLocaleString();
    }

    // Render history list
    function renderHistoryUI(){
      historyList.innerHTML = '';
      for(const h of history.slice(0,40)){
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `<div><div class="name">${h.name}</div><div class="rar">${h.rarity.toUpperCase()}</div></div>
          <div style="text-align:right">
            <div style="font-weight:900">$${h.value.toLocaleString()}</div>
            <div style="font-size:11px;opacity:.75">${new Date(h.ts).toLocaleString()}</div>
          </div>`;
        historyList.appendChild(div);
      }
    }

    // Update balance display and button disabled state
    function updateBalanceUI(){
      balanceEl.textContent = '$' + balance.toLocaleString();
      openBtn.disabled = rolling || balance < currentPack.cost;
    }

    // Open pack animation + logic with sound and exact winner alignment
    async function openPack(){
      if(rolling) return;
      rolling = true;
      openBtn.disabled = true;

      if(balance < currentPack.cost){
        alert('Not enough balance to open this pack.');
        rolling = false;
        updateBalanceUI();
        return;
      }
      balance -= currentPack.cost;
      updateBalanceUI();

      // Start rolling sound loop
      rollSound.currentTime = 0;
      rollSound.volume = 0.3;
      rollSound.loop = true;
      rollSound.play();

      const winner = weightedPickByRarity(currentPack);
      const seq = createRandomStrip(currentPack, 180);
      // Put winner exactly in the middle so it lands right under arrow
      const insertIndex = Math.floor(seq.length/2);
      seq[insertIndex] = winner;

      renderStrip(seq);

      await new Promise(r => requestAnimationFrame(r));
      const itemEl = strip.querySelector('.item');
      const itemW = itemEl.getBoundingClientRect().width + 20;

      // Start offset so many items will pass by
      const startOffset = -(insertIndex - 14) * itemW;
      let translate = startOffset;
      strip.style.transform = `translate(${translate}px, -50%)`;

      const centerX = getCenterX();
      const targetTranslate = -(insertIndex * itemW) + (centerX - itemW/2);

      // Animation duration - faster and more dramatic
      const duration = 2000 + Math.random()*800;
      const start = performance.now();
      const startT = translate;
      const delta = targetTranslate - startT;

      // Overshoot removed to land exactly on winner
      await new Promise(resolve => {
        function step(now){
          const t = Math.min(1,(now - start)/duration);
          // ease out curve
          const ease = 1 - Math.pow(1-t,4);
          const cur = startT + delta*ease;
          strip.style.transform = `translate(${cur}px, -50%)`;

          for(const el of strip.children){
            const r = el.getBoundingClientRect();
            const dist = Math.abs((r.left + r.width/2) - (viewport.getBoundingClientRect().left + centerX));
            const sc = Math.max(.78, 1 - dist/1100);
            el.style.transform = `scale(${sc})`;
            el.style.opacity = Math.max(.28, 1 - dist/700);
          }

          if(t < 1) requestAnimationFrame(step);
          else {
            strip.style.transform = `translate(${targetTranslate}px, -50%)`;
            // Highlight chosen item
            strip.children[insertIndex].style.boxShadow = '0 16px 60px rgba(255,215,0,.9), 0 0 28px rgba(255,215,0,.6)';
            resolve();
          }
        }
        requestAnimationFrame(step);
      });

      // Stop rolling sound
      rollSound.pause();
      rollSound.currentTime = 0;

      award(winner);

      rolling = false;
      updateBalanceUI();
    }

    // Select pack logic + UI setup
    function selectPack(packKey){
      currentPack = packs[packKey];
      packSelector.style.display = 'none';
      mainStage.style.display = 'grid';
      backBtn.style.display = 'inline-block';

      packTitle.textContent = `${currentPack.name} — Case Opener`;
      openBtn.textContent = `Open ${currentPack.name} ($${currentPack.cost.toLocaleString()})`;
      costInfo.innerHTML = `Cost: <strong>$${currentPack.cost.toLocaleString()}</strong>`;
      probInfo.textContent = currentPack.probabilitiesText;

      updateBalanceUI();

      // Render a random strip for the first time
      renderStrip(createRandomStrip(currentPack, 180));
    }

    // Back to pack selection screen
    function backToSelection(){
      mainStage.style.display = 'none';
      packSelector.style.display = 'flex';
      currentPack = null;
      backBtn.style.display = 'none';
      updateBalanceUI();
    }

    // Event listeners
    openBtn.addEventListener('click', openPack);
    backBtn.addEventListener('click', backToSelection);
    document.querySelectorAll('.pack-choice').forEach(el=>{
      el.addEventListener('click', ()=>{
        selectPack(el.dataset.pack);
      });
    });

  </script>
</body>
</html>
